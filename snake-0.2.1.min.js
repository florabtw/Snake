function Point(t,i){this.x=t,this.y=i}function Controls(t){function i(i){y=!0;var n=i.touches[0].pageX-t.offsetLeft,o=i.touches[0].pageY-t.offsetTop;e(n,o)}function n(i){if(!y){var n=i.pageX-t.offsetLeft,o=i.pageY-t.offsetTop;return e(n,o)}}function e(t,i){o(t,i)?w.turnLeft():s(t,i)?w.turnRight():h(t,i)?w.turnUp():r(t,i)&&w.turnDown()}function o(t,i){return c(u,t,i)}function s(t,i){return c(a,t,i)}function h(t,i){return c(d,t,i)}function r(t,i){return c(p,t,i)}function c(t,i,n){var e=t.x<=i&&i<=t.x+l,o=t.y<=n&&n<=t.y+l;return e&&o}const l=50,f=5;var u,a,d,p,w=null;this.updateLocation=function(){u=new Point(t.width-150-15,t.height-l-f),p=new Point(t.width-100-10,t.height-l-f),a=new Point(t.width-l-f,t.height-l-f),d=new Point(t.width-100-10,t.height-100-10)},this.updateLocation(),this.register=function(t){w=t},this.listen=function(){t.addEventListener("touchstart",i),t.addEventListener("click",n)};var y=!1;this.draw=function(t){t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(u.x,u.y,l,l),t.fillRect(a.x,a.y,l,l),t.fillRect(d.x,d.y,l,l),t.fillRect(p.x,p.y,l,l)}}function ResetButton(t,i){function n(n){var o=n.pageX-t.offsetLeft,s=n.pageY-t.offsetTop,h=e.x<=o&&o<=e.x+e.width,r=e.y<=s&&s<=e.y+e.height;h&&r&&i.reset()}this.x=10,this.y=t.height-50,this.width=100,this.height=40;var e=this;this.updateLocation=function(){this.y=t.height-50},this.listen=function(){t.addEventListener("click",n,!1)},this.draw=function(t){t.fillRect(this.x,this.y,this.width,this.height),t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#333";var i=this.x+this.width/2,n=this.y+this.height/2;t.fillText("Reset",i,n)}}function Score(){this.score=0,this.reset=function(){this.score=0},this.increment=function(){this.score++},this.draw=function(t){t.font="bold 36px sans-serif",t.textAlign="left",t.textBaseline="top",t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillText("Score: "+this.score,10,10)}}function Snake(){this.points=[new Point(BLOCK_SIZE,BLOCK_SIZE)],this.direction=Direction.RIGHT;var t=this;this.reset=function(){this.points=[new Point(50,50)],this.direction=Direction.RIGHT},this.headCollidesWithWall=function(t){var i=this.points[0],n=0>i.x||i.x>t.width-BLOCK_SIZE,e=0>i.y||i.y>t.height-BLOCK_SIZE;return n||e},this.headCollidesWithSelf=function(){var t=this.points[0];for(i=1;i<this.points.length;i++)if(t.x==this.points[i].x&&t.y==this.points[i].y)return!0;return!1},this.headCollidesWithApple=function(t){var i=this.points[0];return i.x===t.x&&i.y===t.y},this.turnLeft=function(){(1===t.points.length||t.points[1].x===t.points[0].x)&&(t.direction=Direction.LEFT)},this.turnRight=function(){(1===t.points.length||t.points[1].x===t.points[0].x)&&(t.direction=Direction.RIGHT)},this.turnUp=function(){(1===t.points.length||t.points[1].y===t.points[0].y)&&(t.direction=Direction.UP)},this.turnDown=function(){(1===t.points.length||t.points[1].y===t.points[0].y)&&(t.direction=Direction.DOWN)};var n={37:this.turnLeft,38:this.turnUp,39:this.turnRight,40:this.turnDown};this.listenForKeyPress=function(t){t.addEventListener("keydown",function(t){var i=t.keyCode;i>=37&&40>=i&&(t.preventDefault(),n[i]())})},this.draw=function(t){for(t.fillStyle="black",i=0;i<this.points.length;i++)t.fillRect(this.points[i].x,this.points[i].y,BLOCK_SIZE,BLOCK_SIZE)}}function Apple(t){function i(){var i=Math.random()*(t.width-BLOCK_SIZE);return Math.round(i/BLOCK_SIZE)*BLOCK_SIZE}function n(){var i=Math.random()*(t.height-BLOCK_SIZE);return Math.round(i/BLOCK_SIZE)*BLOCK_SIZE}this.x=i(),this.y=n(),this.move=function(){this.x=i(),this.y=n()},this.draw=function(t){t.fillRect(this.x,this.y,BLOCK_SIZE,BLOCK_SIZE)}}function SnakeGame(t){function n(){var n=Date.now();if(n-f>50){if(f=n,o.headCollidesWithApple(s)){var e=o.points[o.points.length-1];o.points.push(new Point(e.x,e.y)),r.increment(),s.move()}for(i=o.points.length-1;i>0;i--)o.points[i].x=o.points[i-1].x,o.points[i].y=o.points[i-1].y;o.direction===Direction.LEFT?o.points[0].x-=BLOCK_SIZE:o.direction===Direction.RIGHT?o.points[0].x+=BLOCK_SIZE:o.direction===Direction.UP?o.points[0].y-=BLOCK_SIZE:o.points[0].y+=BLOCK_SIZE,(o.headCollidesWithWall(t)||o.headCollidesWithSelf())&&(u=!0)}}function e(){l.clearRect(0,0,t.width,t.height),o.draw(l),s.draw(l),r.draw(l),h.draw(l),null!==c&&c.draw(l)}var o=new Snake,s=new Apple(t),h=new ResetButton(t,this),r=new Score,c=null,l=t.getContext("2d"),f=Date.now(),u=!1;this.resize=function(){var i=s.x>t.width-BLOCK_SIZE,n=s.y>t.height-BLOCK_SIZE;(i||n)&&s.move(),h.updateLocation(),null!==c&&c.updateLocation(),e()},this.reset=function(){u=!1,f=Date.now(),o.reset(),s.move(),r.reset()},this.enableControls=function(){c=new Controls(t),c.register(o)},this.play=function(){function i(){u||(n(),e())}if(h.listen(),o.listenForKeyPress(t),null!==c&&c.listen(),null!==window.requestAnimationFrame){var s=function(){i(),window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}else setInterval(i,1e3/60)}}const BLOCK_SIZE=10;var Direction={LEFT:0,RIGHT:1,UP:2,DOWN:3};