function Point(t,i){this.x=t,this.y=i}function Controls(t){function i(i){var h=i.pageX-t.offsetLeft,r=i.pageY-t.offsetTop;n(h,r)?d.turnLeft():e(h,r)?d.turnRight():o(h,r)?d.turnUp():s(h,r)&&d.turnDown()}function n(t,i){return h(c,t,i)}function e(t,i){return h(u,t,i)}function o(t,i){return h(f,t,i)}function s(t,i){return h(a,t,i)}function h(t,i,n){var e=t.x<=i&&i<=t.x+r,o=t.y<=n&&n<=t.y+r;return e&&o}const r=50,l=5;var c,u,f,a,d=null;this.updateLocation=function(){c=new Point(t.width-150-15,t.height-r-l),a=new Point(t.width-100-10,t.height-r-l),u=new Point(t.width-r-l,t.height-r-l),f=new Point(t.width-100-10,t.height-100-10)},this.updateLocation(),this.register=function(t){d=t},this.listen=function(){window.addEventListener("mousedown",i,!1)},this.draw=function(t){t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillRect(c.x,c.y,r,r),t.fillRect(u.x,u.y,r,r),t.fillRect(f.x,f.y,r,r),t.fillRect(a.x,a.y,r,r)}}function ResetButton(t,i){function n(n){var o=n.pageX-t.offsetLeft,s=n.pageY-t.offsetTop,h=e.x<=o&&o<=e.x+e.width,r=e.y<=s&&s<=e.y+e.height;h&&r&&i.reset()}this.x=10,this.y=t.height-50,this.width=100,this.height=40;var e=this;this.updateLocation=function(){this.y=t.height-50},this.listen=function(){window.addEventListener("mousedown",n,!1)},this.draw=function(t){t.fillRect(this.x,this.y,this.width,this.height),t.font="16px sans-serif",t.textAlign="center",t.textBaseline="middle",t.fillStyle="#333";var i=this.x+this.width/2,n=this.y+this.height/2;t.fillText("Reset",i,n)}}function Score(){this.score=0,this.reset=function(){this.score=0},this.increment=function(){this.score++},this.draw=function(t){t.font="bold 36px sans-serif",t.textAlign="left",t.textBaseline="top",t.fillStyle="rgba(0, 0, 0, 0.1)",t.fillText("Score: "+this.score,10,10)}}function Snake(){this.points=[new Point(BLOCK_SIZE,BLOCK_SIZE)],this.direction=Direction.RIGHT;var t=this;this.reset=function(){this.points=[new Point(50,50)],this.direction=Direction.RIGHT},this.headCollidesWithWall=function(t){var i=this.points[0],n=0>i.x||i.x>t.width-BLOCK_SIZE,e=0>i.y||i.y>t.height-BLOCK_SIZE;return n||e},this.headCollidesWithSelf=function(){var t=this.points[0];for(i=1;i<this.points.length;i++)if(t.x==this.points[i].x&&t.y==this.points[i].y)return!0;return!1},this.headCollidesWithApple=function(t){var i=this.points[0];return i.x===t.x&&i.y===t.y},this.turnLeft=function(){(1===t.points.length||t.points[1].x===t.points[0].x)&&(t.direction=Direction.LEFT)},this.turnRight=function(){(1===t.points.length||t.points[1].x===t.points[0].x)&&(t.direction=Direction.RIGHT)},this.turnUp=function(){(1===t.points.length||t.points[1].y===t.points[0].y)&&(t.direction=Direction.UP)},this.turnDown=function(){(1===t.points.length||t.points[1].y===t.points[0].y)&&(t.direction=Direction.DOWN)};var n={37:this.turnLeft,38:this.turnUp,39:this.turnRight,40:this.turnDown};this.listenForKeyPress=function(t){t.addEventListener("keydown",function(t){var i=t.keyCode;i>=37&&40>=i&&(t.preventDefault(),n[i]())})},this.draw=function(t){for(t.fillStyle="black",i=0;i<this.points.length;i++)t.fillRect(this.points[i].x,this.points[i].y,BLOCK_SIZE,BLOCK_SIZE)}}function Apple(t){function i(){var i=Math.random()*(t.width-BLOCK_SIZE);return Math.round(i/BLOCK_SIZE)*BLOCK_SIZE}function n(){var i=Math.random()*(t.height-BLOCK_SIZE);return Math.round(i/BLOCK_SIZE)*BLOCK_SIZE}this.x=i(),this.y=n(),this.move=function(){this.x=i(),this.y=n()},this.draw=function(t){t.fillRect(this.x,this.y,BLOCK_SIZE,BLOCK_SIZE)}}function SnakeGame(t){function n(){var n=Date.now();if(n-u>50){if(u=n,o.headCollidesWithApple(s)){var e=o.points[o.points.length-1];o.points.push(new Point(e.x,e.y)),r.increment(),s.move()}for(i=o.points.length-1;i>0;i--)o.points[i].x=o.points[i-1].x,o.points[i].y=o.points[i-1].y;o.direction===Direction.LEFT?o.points[0].x-=BLOCK_SIZE:o.direction===Direction.RIGHT?o.points[0].x+=BLOCK_SIZE:o.direction===Direction.UP?o.points[0].y-=BLOCK_SIZE:o.points[0].y+=BLOCK_SIZE,(o.headCollidesWithWall(t)||o.headCollidesWithSelf())&&(f=!0)}}function e(){c.clearRect(0,0,t.width,t.height),o.draw(c),s.draw(c),r.draw(c),h.draw(c),null!==l&&l.draw(c)}var o=new Snake,s=new Apple(t),h=new ResetButton(t,this),r=new Score,l=null,c=t.getContext("2d"),u=Date.now(),f=!1;this.resize=function(){var i=s.x>t.width-BLOCK_SIZE,n=s.y>t.height-BLOCK_SIZE;(i||n)&&s.move(),h.updateLocation(),null!==l&&l.updateLocation(),e()},this.reset=function(){f=!1,u=Date.now(),o.reset(),s.move(),r.reset()},this.enableControls=function(){l=new Controls(t),l.register(o)},this.play=function(){function i(){f||(n(),e())}if(h.listen(),o.listenForKeyPress(t),null!==l&&l.listen(),null!==window.requestAnimationFrame){var s=function(){i(),window.requestAnimationFrame(s)};window.requestAnimationFrame(s)}else setInterval(i,1e3/60)}}const BLOCK_SIZE=10;var Direction={LEFT:0,RIGHT:1,UP:2,DOWN:3};